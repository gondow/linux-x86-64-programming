<style type="text/css">
body { counter-reset: chapter 9; }
</style>

# GCCが生成したアセンブリコードを読む

この章では単純なCのプログラムをGCCがどのようなアセンブリコードに変換するかを見ていきます．
これより以前の章で学んだ知識を使えば，C言語のコードが意外に簡単にアセンブリコードに変換できることが分かると思います．
(実際にコンパイラの授業で構文解析の手法を学び，
最適化器を実装しなければ，コンパイラは学部生でも十分簡単に作れます)．

## 制御文

### if文

```
{{#include asm/if.c}}
```

<img src="figs/if.svg" height="250px" id="fig:if">

- ifの条件式`x > 100`は反転して「`x <= 100`なら，then部分をスキップして，thenの直後(ラベル`.L2`)にジャンプする」というコードを出力しています．
  (反転する必然性はありません．`x > 0`を評価してその結果が`0`に等しければ，`.L2`にジャンプするコードでも(実行速度を除けば)同じ動作になります)
- then部分では「`x`に1を加える」コードを出力しています．

<details>
<summary>
なぜGCCはinc命令を使わないの?
</summary>

`incl x(%rip)`なら1命令で済みますよね．
もし`-O`や`-O2`などの最適化オプションを付ければ，
GCCは`inc`を使うかも知れませんが，
そうしてしまうと，(最適化が賢すぎて)元のif文の構造がガラリと変わってしまう可能性があるため避けています．
この章では全て「最適化オプションを付けていないので，GCCは無駄なコードを出力することがある」と考えて下さい．
</details>

### if-else文

```
{{#include asm/if-else.c}}
```

<img src="figs/if-else.svg" height="330px" id="fig:if-else">

- ifの条件式`x > 100`は反転して「`x <= 100`なら，then部分をスキップして，thenの直後(ラベル`.L2`)にジャンプする」というコードを出力しています．
- then部分では「`x`に1を加える．次にelse部分をスキップするために`.L3`にジャンプする」コードを出力しています．
- else部分では「`x`から1減らす」コードを出力しています．

### while文
### for文
### switch文

## 定数

### 整数定数
### 文字定数
### 文字列定数

## 変数

## 式

### 単項演算子
### 二項演算子
### ポインタ演算
### アドレス演算子`&`と逆参照演算子`*`
### 述語演算子
### left-to-right evaluation
### 代入

## 文

### 式文
### ブロック文
### goto文とラベル文
### return文

## 関数

### 関数定義
### 関数コール
### ライブラリ関数コール
### システムコール
